<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Todoyu: C:/Programme/xampp/htdocs/todoyu2/ext/contact/model/TodoyuContactManager.class.php Quellcode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Erzeugt von Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Hauptseite</span></a></li>
      <li><a href="pages.html"><span>Zusätzliche&nbsp;Informationen</span></a></li>
      <li><a href="namespaces.html"><span>Namensbereiche</span></a></li>
      <li><a href="annotated.html"><span>Datenstrukturen</span></a></li>
      <li class="current"><a href="files.html"><span>Dateien</span></a></li>
      <li><a href="examples.html"><span>Beispiele</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Auflistung&nbsp;der&nbsp;Dateien</span></a></li>
      <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
    </ul>
  </div>
<h1>C:/Programme/xampp/htdocs/todoyu2/ext/contact/model/TodoyuContactManager.class.php</h1><a href="_todoyu_contact_manager_8class_8php.html">gehe zur Dokumentation dieser Datei</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/***************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">*  Copyright notice</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">*  (c) 2009 snowflake productions gmbh</span>
<a name="l00006"></a>00006 <span class="comment">*  All rights reserved</span>
<a name="l00007"></a>00007 <span class="comment">*</span>
<a name="l00008"></a>00008 <span class="comment">*  This script is part of the todoyu project.</span>
<a name="l00009"></a>00009 <span class="comment">*  The todoyu project is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment">*  it under the terms of the GNU General Public License, version 2,</span>
<a name="l00011"></a>00011 <span class="comment">*  (http://www.gnu.org/licenses/old-licenses/gpl-2.0.html) as published by</span>
<a name="l00012"></a>00012 <span class="comment">*  the Free Software Foundation;</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*  This script is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">*  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<a name="l00017"></a>00017 <span class="comment">*  GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment">*</span>
<a name="l00019"></a>00019 <span class="comment">*  This copyright notice MUST APPEAR in all copies of the script!</span>
<a name="l00020"></a>00020 <span class="comment">***************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00026"></a><a class="code" href="class_todoyu_contact_manager.html">00026</a> <span class="keyword">class </span><a class="code" href="class_todoyu_contact_manager.html">TodoyuContactManager</a> {
<a name="l00027"></a>00027 
<a name="l00033"></a><a class="code" href="class_todoyu_contact_manager.html#a68db4825703c78ef49861215921b3f5e">00033</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a68db4825703c78ef49861215921b3f5e">getTypesConfig</a>() {
<a name="l00034"></a>00034         <span class="keywordflow">return</span> <a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;EXT&apos;</span>][<span class="stringliteral">&apos;contact&apos;</span>][<span class="stringliteral">&apos;contacttypes&apos;</span>];
<a name="l00035"></a>00035     }
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00045"></a>00045 <span class="comment">//  public function ListPersons($sword) {</span>
<a name="l00046"></a>00046 <span class="comment">//      $searchFields   = array(</span>
<a name="l00047"></a>00047 <span class="comment">//          &apos;firstname&apos;,</span>
<a name="l00048"></a>00048 <span class="comment">//          &apos;lastname&apos;</span>
<a name="l00049"></a>00049 <span class="comment">//      );</span>
<a name="l00050"></a>00050 <span class="comment">//</span>
<a name="l00051"></a>00051 <span class="comment">//      $users = TodoyuUserManager::searchUsers($sword, $searchFields);</span>
<a name="l00052"></a>00052 <span class="comment">//</span>
<a name="l00053"></a>00053 <span class="comment">//      return self::getAssociatedContacttypeRecordsList($userResult, &apos;TodoyuUser&apos;);</span>
<a name="l00054"></a>00054 <span class="comment">//  }</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00064"></a><a class="code" href="class_todoyu_contact_manager.html#a211aa12b9af24f48c509629718683786">00064</a>     <span class="keyword">public</span> function <a class="code" href="class_todoyu_contact_manager.html#a211aa12b9af24f48c509629718683786">ListCompanies</a>($sword)   {
<a name="l00065"></a>00065         $companyResult = <a class="code" href="class_todoyu_customer_manager.html#a36a87bed460f5939d28f9846a8023512">TodoyuCustomerManager::searchCustomers</a>($sword);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         <span class="keywordflow">return</span> self::getAssociatedContacttypeRecordsList($companyResult, <span class="stringliteral">&apos;TodoyuCustomer&apos;</span>);
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00079"></a>00079     <span class="keyword">private</span> <span class="keyword">static</span> function getAssociatedContacttypeRecordsList($searchResult, $contacttypeClass = <span class="stringliteral">&apos;TodoyuCustomer&apos;</span>) {
<a name="l00080"></a>00080         $resArray   = array();
<a name="l00081"></a>00081         $index      = 0;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <span class="keywordflow">if</span>( $searchResult === <span class="keyword">false</span> )   {
<a name="l00084"></a>00084                 <span class="comment">// No entry found</span>
<a name="l00085"></a>00085             $resArray   = <span class="keyword">false</span>;
<a name="l00086"></a>00086         } <span class="keywordflow">else</span> {
<a name="l00087"></a>00087                 <span class="comment">// Iterate associated records (persons/ companies..)</span>
<a name="l00088"></a>00088             <span class="keywordflow">while</span>($assRecord = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;fetchAssoc($searchResult)) {
<a name="l00089"></a>00089                 $typeObj = <span class="keyword">new</span> $contacttypeClass($assRecord[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091                 $resArray[$index]                   = $typeObj-&gt;getTemplateData();
<a name="l00092"></a>00092                 $resArray[$index][<span class="stringliteral">&apos;renderClass&apos;</span>]    = ($index % 2) ? <span class="stringliteral">&apos;odd&apos;</span> : <span class="stringliteral">&apos;even&apos;</span>;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094                 $index++;
<a name="l00095"></a>00095             }
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="keywordflow">return</span> $resArray;
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00109"></a><a class="code" href="class_todoyu_contact_manager.html#a589165fe76d4248cccad1004d526a6d5">00109</a>     <span class="keyword">public</span> function <a class="code" href="class_todoyu_contact_manager.html#a589165fe76d4248cccad1004d526a6d5">ListJobtypes</a>()  {
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="keywordflow">return</span> self::getContactTypeEntriesArray(<span class="stringliteral">&apos;ext_user_jobtype&apos;</span>);
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00123"></a><a class="code" href="class_todoyu_contact_manager.html#a46a6212eb5ed3682ad5297e3503aa45f">00123</a>     <span class="keyword">public</span> function <a class="code" href="class_todoyu_contact_manager.html#a46a6212eb5ed3682ad5297e3503aa45f">ListCustomerroles</a>() {
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         <span class="keywordflow">return</span> self::getContactTypeEntriesArray(<span class="stringliteral">&apos;ext_user_customerrole&apos;</span>);
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 
<a name="l00136"></a>00136     <span class="keyword">private</span> <span class="keyword">static</span> function getContactTypeEntriesArray(<a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> = <span class="stringliteral">&apos;ext_user_customerrole&apos;</span>) {
<a name="l00137"></a>00137         $result = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;doSelect(<span class="stringliteral">&apos;id, title&apos;</span>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <span class="stringliteral">&apos;deleted = 0&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;title&apos;</span>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         $array  = array();
<a name="l00140"></a>00140         <span class="keywordflow">while</span>($row = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;fetchAssoc($result)) {
<a name="l00141"></a>00141             $array[] = array(
<a name="l00142"></a>00142                 <span class="stringliteral">&apos;id&apos;</span>    =&gt; $row[<span class="stringliteral">&apos;id&apos;</span>],
<a name="l00143"></a>00143                 <span class="stringliteral">&apos;label&apos;</span> =&gt; $row[<span class="stringliteral">&apos;title&apos;</span>],
<a name="l00144"></a>00144             );
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         <span class="keywordflow">return</span> $array;
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 
<a name="l00159"></a><a class="code" href="class_todoyu_contact_manager.html#af1025ffa75410692a3eca7b5a265369f">00159</a>     <span class="keyword">protected</span> function <a class="code" href="class_todoyu_contact_manager.html#af1025ffa75410692a3eca7b5a265369f">prepareBaseObjListData</a>($result, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>)  {
<a name="l00160"></a>00160         $baseObjArray   = array();
<a name="l00161"></a>00161         $index          = 0;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         <span class="keywordflow">while</span>($baseObjRecord = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;fetchAssoc($result))   {
<a name="l00164"></a>00164             $baseObj = <span class="keyword">new</span> <a class="code" href="class_todoyu_base_object.html">TodoyuBaseObject</a>($baseObjRecord[<span class="stringliteral">&apos;id&apos;</span>], <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166             $baseObjArray[$index] = $baseObj-&gt;getTemplateData();
<a name="l00167"></a>00167             $baseObjArray[$index][<span class="stringliteral">&apos;renderClass&apos;</span>] = ($index%2) ? <span class="stringliteral">&apos;odd&apos;</span>:<span class="stringliteral">&apos;even&apos;</span>;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169             $index++;
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172         <span class="keywordflow">return</span> $baseObjArray;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 
<a name="l00183"></a><a class="code" href="class_todoyu_contact_manager.html#a62f688f84db9c5ede6718b08bff1d31d">00183</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a62f688f84db9c5ede6718b08bff1d31d">getContactTypeFromXml</a>($contactType) {
<a name="l00184"></a>00184         $typeConfig = <a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;EXT&apos;</span>][<span class="stringliteral">&apos;contact&apos;</span>][<span class="stringliteral">&apos;contacttypes&apos;</span>][$contactType];
<a name="l00185"></a>00185 
<a name="l00186"></a>00186         <span class="keywordflow">if</span>( is_array($typeConfig) ) {
<a name="l00187"></a>00187             <span class="keywordflow">return</span> $typeConfig[<span class="stringliteral">&apos;formXml&apos;</span>];
<a name="l00188"></a>00188         } <span class="keywordflow">else</span> {
<a name="l00189"></a>00189             <a class="code" href="class_todoyu_debug.html#adc1d20befc0f0af3f20834265b0f81ac">TodoyuDebug::printInFirebug</a>($contactType, <span class="stringliteral">&apos;Invalid contact tpye&apos;</span>);
<a name="l00190"></a>00190             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00201"></a><a class="code" href="class_todoyu_contact_manager.html#a586cd905db31c9715434498b677894b9">00201</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a586cd905db31c9715434498b677894b9">getContactTypeObjClass</a>($type) {
<a name="l00202"></a>00202         <span class="keywordflow">return</span> <a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;EXT&apos;</span>][<span class="stringliteral">&apos;contact&apos;</span>][<span class="stringliteral">&apos;contacttypes&apos;</span>][$type][<span class="stringliteral">&apos;objClass&apos;</span>];
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 
<a name="l00212"></a><a class="code" href="class_todoyu_contact_manager.html#a80235fa5235cc703e79fdc73d12ffc55">00212</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a80235fa5235cc703e79fdc73d12ffc55">getContactTypeLabel</a>($type)   {
<a name="l00213"></a>00213         <span class="keywordflow">return</span> <a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;EXT&apos;</span>][<span class="stringliteral">&apos;contact&apos;</span>][<span class="stringliteral">&apos;contacttypes&apos;</span>][$type][<span class="stringliteral">&apos;label&apos;</span>];
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00224"></a><a class="code" href="class_todoyu_contact_manager.html#aca33f99b354bf434fe28663d823dac1d">00224</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#aca33f99b354bf434fe28663d823dac1d">getContactTypeObj</a>($type, $idRecord)  {
<a name="l00225"></a>00225         $idRecord   = intval($idRecord);
<a name="l00226"></a>00226         $className  = <a class="code" href="class_todoyu_contact_manager.html#a586cd905db31c9715434498b677894b9">self::getContactTypeObjClass</a>($type);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228         <span class="keywordflow">return</span> <span class="keyword">new</span> $className($idRecord);
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00240"></a><a class="code" href="class_todoyu_contact_manager.html#ad8fe84278c157e2841dd3064bc7377ef">00240</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#ad8fe84278c157e2841dd3064bc7377ef">getCountryLabel</a>(<a class="code" href="ext_2dev_2controller_2form_8php.html#a1a4fda4c28a9ee5f91102c023b9501f4">$form</a>, $option)  {
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         <span class="keywordflow">return</span> $option[ <span class="stringliteral">&apos;name_&apos;</span> . <a class="code" href="class_todoyu_locale.html#a7166a1dbef39ee5a6bcabf6bca93a654">TodoyuLocale::getLocale</a>() ];
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00254"></a>00254 <span class="comment">//  public static function modifyUserFormfields(TodoyuForm $form, $userIndex) {</span>
<a name="l00255"></a>00255 <span class="comment">//      $userIndex      = intval( $userIndex );</span>
<a name="l00256"></a>00256 <span class="comment">//      $contactType    = TodoyuContactPreferences::getActiveTab();</span>
<a name="l00257"></a>00257 <span class="comment">//</span>
<a name="l00258"></a>00258 <span class="comment">//      if ($contactType == &apos;company&apos;) {</span>
<a name="l00259"></a>00259 <span class="comment">//          $form-&gt;addElementsFromXML( &apos;ext/contact/config/form/user-jobtypeaddress.xml&apos; );</span>
<a name="l00260"></a>00260 <span class="comment">//      }</span>
<a name="l00261"></a>00261 <span class="comment">//</span>
<a name="l00262"></a>00262 <span class="comment">//      return $form;</span>
<a name="l00263"></a>00263 <span class="comment">//  }</span>
<a name="l00264"></a>00264 <span class="comment">//</span>
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 
<a name="l00284"></a><a class="code" href="class_todoyu_contact_manager.html#ab461224b857f53565013b168fbad5ba2">00284</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#ab461224b857f53565013b168fbad5ba2">buildOptionsArray</a>( $res, $valueField, $labelField, $selectedIndex = null, $selectedValue = null ) {
<a name="l00285"></a>00285         $options    = array();
<a name="l00286"></a>00286         <span class="keywordflow">foreach</span>($res as $index =&gt; <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>) {
<a name="l00287"></a>00287             $options[]  = array(
<a name="l00288"></a>00288                 <span class="stringliteral">&apos;value&apos;</span>     =&gt; <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>[ $valueField ],
<a name="l00289"></a>00289                 <span class="stringliteral">&apos;label&apos;</span>     =&gt; <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>[ $labelField ],
<a name="l00290"></a>00290                 <span class="stringliteral">&apos;selected&apos;</span>  =&gt; ( (! is_null($selectedIndex) &amp;&amp; $index == $selectedIndex)  || (! is_null($selectedValue) &amp;&amp; <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>[ $valueField ] == $selectedValue) ) ? <span class="stringliteral">&apos;selected&apos;</span> : <span class="stringliteral">&apos;&apos;</span>,
<a name="l00291"></a>00291                 <span class="stringliteral">&apos;disabled&apos;</span>  =&gt; <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>[ $valueField ] == -1 ? <span class="charliteral">&apos;1&apos;</span> : <span class="stringliteral">&apos;&apos;</span>,
<a name="l00292"></a>00292             );
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="keywordflow">return</span> $options;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 
<a name="l00307"></a><a class="code" href="class_todoyu_contact_manager.html#a39194462443c0662217b3214bd23011d">00307</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a39194462443c0662217b3214bd23011d">savePerson</a>(array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>)  {
<a name="l00308"></a>00308         <a class="code" href="ext_2dev_2controller_2form_8php.html#aec7b9eb932d6a244586d33c16797dc4a">$xmlPath</a>= <a class="code" href="class_todoyu_contact_manager.html#a62f688f84db9c5ede6718b08bff1d31d">self::getContactTypeFromXml</a>(<span class="stringliteral">&apos;person&apos;</span>);
<a name="l00309"></a>00309         $idUser = intval($data[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="keywordflow">if</span>( $idUser === 0 ) {
<a name="l00312"></a>00312             $idUser = <a class="code" href="class_todoyu_user_manager.html#ac18bad781c8bf939cd634e2b792477e9">TodoyuUserManager::addUser</a>();
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315         $data   = <a class="code" href="class_todoyu_contact_manager.html#a3526f3295687fbe1d5237c79063f2778">self::saveUserForeignRecords</a>($data, $idUser);
<a name="l00316"></a>00316         $data   = <a class="code" href="class_todoyu_form_hook.html#a661781c57898f2b71c3c241515510324">TodoyuFormHook::callSaveData</a>(<a class="code" href="ext_2dev_2controller_2form_8php.html#aec7b9eb932d6a244586d33c16797dc4a">$xmlPath</a>, $data, $idUser);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318         <a class="code" href="class_todoyu_user_manager.html#a2fde7613d98bf6fd80d3240388b93c66">TodoyuUserManager::updateUser</a>($idUser, $data);
<a name="l00319"></a>00319         <a class="code" href="class_todoyu_user_manager.html#a4e1529336b0f1c5a152d7d931aaaf4db">TodoyuUserManager::removeFromCache</a>($idUser);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         <span class="keywordflow">return</span> $idUser;
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 
<a name="l00332"></a><a class="code" href="class_todoyu_contact_manager.html#a155c145d180af741e717c8ec57063761">00332</a>     <span class="keyword">public</span> function <a class="code" href="class_todoyu_contact_manager.html#a155c145d180af741e717c8ec57063761">saveCompany</a>(array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>)    {
<a name="l00333"></a>00333         <a class="code" href="ext_2dev_2controller_2form_8php.html#aec7b9eb932d6a244586d33c16797dc4a">$xmlPath</a>    = <span class="stringliteral">&apos;ext/contact/config/form/company.xml&apos;</span>;
<a name="l00334"></a>00334         $idCustomer = intval($data[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00335"></a>00335 
<a name="l00336"></a>00336         <span class="keywordflow">if</span>( $idCustomer === 0 ) {
<a name="l00337"></a>00337             $idCustomer = <a class="code" href="class_todoyu_customer_manager.html#aee4ff12f31642902a6cc89ac0b9f81d9">TodoyuCustomerManager::addCustomer</a>();
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340             <span class="comment">// Save own external fields</span>
<a name="l00341"></a>00341         $data   = <a class="code" href="class_todoyu_contact_manager.html#a7f60cc467c0415df1c1c9f7e1341aad7">self::saveCustomerForeignRecords</a>($data, $idCustomer);
<a name="l00342"></a>00342 
<a name="l00343"></a>00343             <span class="comment">// Call save data hook</span>
<a name="l00344"></a>00344         $data   = <a class="code" href="class_todoyu_form_hook.html#a661781c57898f2b71c3c241515510324">TodoyuFormHook::callSaveData</a>(<a class="code" href="ext_2dev_2controller_2form_8php.html#aec7b9eb932d6a244586d33c16797dc4a">$xmlPath</a>, $data, $idCustomer);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <a class="code" href="class_todoyu_customer_manager.html#a1236afe948ab90bd0c29f2f5279037f5">TodoyuCustomerManager::updateCustomer</a>($idCustomer, $data);
<a name="l00347"></a>00347         <a class="code" href="class_todoyu_customer_manager.html#a6d154ae5773d9ab594fac83598b4f403">TodoyuCustomerManager::removeFromCache</a>($idCustomer);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349         <span class="keywordflow">return</span> $idCustomer;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 
<a name="l00366"></a><a class="code" href="class_todoyu_contact_manager.html#a3526f3295687fbe1d5237c79063f2778">00366</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a3526f3295687fbe1d5237c79063f2778">saveUserForeignRecords</a>(array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>, $idUser) {
<a name="l00367"></a>00367         $idUser     = intval($idUser);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369                 <span class="comment">// Remove existing records</span>
<a name="l00370"></a>00370         <a class="code" href="class_todoyu_contact_manager.html#a110f28e91baabc89af6bd4f0d9fbea79">self::removeAllCustomers</a>($idUser);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372             <span class="comment">// Save customer records</span>
<a name="l00373"></a>00373         <span class="keywordflow">if</span>( ! empty($data[<span class="stringliteral">&apos;customer&apos;</span>]) ) {
<a name="l00374"></a>00374             <span class="keywordflow">foreach</span>($data[<span class="stringliteral">&apos;customer&apos;</span>] as $customer) {
<a name="l00375"></a>00375                 $customer[<span class="stringliteral">&apos;id_customer&apos;</span>]= $customer[<span class="stringliteral">&apos;id&apos;</span>];
<a name="l00376"></a>00376                 $customer[<span class="stringliteral">&apos;id_user&apos;</span>]    = $idUser;
<a name="l00377"></a>00377                 unset($customer[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379                     <span class="comment">// Remove existing link and save new data</span>
<a name="l00380"></a>00380                 $idLink = <a class="code" href="class_todoyu_db_helper.html#a4f0d427cb0008ca2af9364b2a79d5609">TodoyuDbHelper::saveExtendedMMrelation</a>(<span class="stringliteral">&apos;ext_user_mm_customer_user&apos;</span>, <span class="stringliteral">&apos;id_customer&apos;</span>, <span class="stringliteral">&apos;id_user&apos;</span>, $customer[<span class="stringliteral">&apos;id_customer&apos;</span>], $idUser, $customer);
<a name="l00381"></a>00381             }
<a name="l00382"></a>00382         }
<a name="l00383"></a>00383         unset($data[<span class="stringliteral">&apos;customer&apos;</span>]);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 
<a name="l00386"></a>00386             <span class="comment">// Save contactinfo records</span>
<a name="l00387"></a>00387         <span class="keywordflow">if</span>( ! empty($data[<span class="stringliteral">&apos;contactinfo&apos;</span>]) ) {
<a name="l00388"></a>00388             $infoIDs    = array();
<a name="l00389"></a>00389             <span class="keywordflow">foreach</span>($data[<span class="stringliteral">&apos;contactinfo&apos;</span>] as $contactInfo) {
<a name="l00390"></a>00390                 $infoIDs[] = <a class="code" href="class_todoyu_contact_info_manager.html#a2eb5494dea333a37f8fdb201b96bcc21">TodoyuContactInfoManager::saveContactInfos</a>($contactInfo);
<a name="l00391"></a>00391             }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393             <a class="code" href="class_todoyu_contact_manager.html#a58e911563438c98f6800ae9ba4ad6b4d">self::linkUserToContactinfos</a>($idUser, $infoIDs);
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395         unset($data[<span class="stringliteral">&apos;contactinfo&apos;</span>]);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 
<a name="l00398"></a>00398             <span class="comment">// Save address records</span>
<a name="l00399"></a>00399         <span class="keywordflow">if</span>( ! empty($data[<span class="stringliteral">&apos;address&apos;</span>]) ) {
<a name="l00400"></a>00400             $addressIDs = array();
<a name="l00401"></a>00401             <span class="keywordflow">foreach</span>($data[<span class="stringliteral">&apos;address&apos;</span>] as $address) {
<a name="l00402"></a>00402                 $addressIDs[] =  <a class="code" href="class_todoyu_address_manager.html#ac22f2342c3330225a25d07f15c424255">TodoyuAddressManager::saveAddress</a>($address);
<a name="l00403"></a>00403             }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405             <a class="code" href="class_todoyu_contact_manager.html#af7d32c261a3af28f5746a757a24a4aa6">self::linkUserToAddresses</a>($idUser, $addressIDs);
<a name="l00406"></a>00406         }
<a name="l00407"></a>00407         unset($data[<span class="stringliteral">&apos;address&apos;</span>]);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409         <span class="keywordflow">return</span> $data;
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 
<a name="l00419"></a><a class="code" href="class_todoyu_contact_manager.html#a110f28e91baabc89af6bd4f0d9fbea79">00419</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a110f28e91baabc89af6bd4f0d9fbea79">removeAllCustomers</a>($idUser) {
<a name="l00420"></a>00420         $idUser = intval($idUser);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         <a class="code" href="class_todoyu_db_helper.html#a7f7e8b72681f08b8247a09747d20fcfe">TodoyuDbHelper::removeMMrelations</a>(<span class="stringliteral">&apos;ext_user_mm_customer_user&apos;</span>, <span class="stringliteral">&apos;id_user&apos;</span>, $idUser);
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00433"></a><a class="code" href="class_todoyu_contact_manager.html#a6d1d86b32b80c40ea63ae624e469dc74">00433</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a6d1d86b32b80c40ea63ae624e469dc74">linkUserToCustomers</a>($idUser, array $customerIDs) {
<a name="l00434"></a>00434         $idUser     = intval($idUser);
<a name="l00435"></a>00435         $customerIDs= <a class="code" href="class_todoyu_array.html#abc24cb3709e3777abbc097959ca0498a">TodoyuArray::intval</a>($customerIDs, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437         <a class="code" href="class_todoyu_db_helper.html#a18b61d6a0c4349de2adda6f0d96b3e7d">TodoyuDbHelper::saveMMrelations</a>(<span class="stringliteral">&apos;ext_user_mm_customer_user&apos;</span>, <span class="stringliteral">&apos;id_user&apos;</span>, <span class="stringliteral">&apos;id_customer&apos;</span>, $idUser, $customerIDs, <span class="keyword">true</span>);
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 
<a name="l00448"></a><a class="code" href="class_todoyu_contact_manager.html#a58e911563438c98f6800ae9ba4ad6b4d">00448</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a58e911563438c98f6800ae9ba4ad6b4d">linkUserToContactinfos</a>($idUser, array $contactinfoIDs) {
<a name="l00449"></a>00449         $idUser         = intval($idUser);
<a name="l00450"></a>00450         $contactinfoIDs = <a class="code" href="class_todoyu_array.html#abc24cb3709e3777abbc097959ca0498a">TodoyuArray::intval</a>($contactinfoIDs, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452         <a class="code" href="class_todoyu_db_helper.html#a18b61d6a0c4349de2adda6f0d96b3e7d">TodoyuDbHelper::saveMMrelations</a>(<span class="stringliteral">&apos;ext_user_mm_user_contactinfo&apos;</span>, <span class="stringliteral">&apos;id_user&apos;</span>, <span class="stringliteral">&apos;id_contactinfo&apos;</span>, $idUser, $contactinfoIDs, <span class="keyword">true</span>);
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 
<a name="l00463"></a><a class="code" href="class_todoyu_contact_manager.html#af7d32c261a3af28f5746a757a24a4aa6">00463</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#af7d32c261a3af28f5746a757a24a4aa6">linkUserToAddresses</a>($idUser, array $addressIDs) {
<a name="l00464"></a>00464         $idUser     = intval($idUser);
<a name="l00465"></a>00465         $addressIDs = <a class="code" href="class_todoyu_array.html#abc24cb3709e3777abbc097959ca0498a">TodoyuArray::intval</a>($addressIDs, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <a class="code" href="class_todoyu_db_helper.html#a18b61d6a0c4349de2adda6f0d96b3e7d">TodoyuDbHelper::saveMMrelations</a>(<span class="stringliteral">&apos;ext_user_mm_user_address&apos;</span>, <span class="stringliteral">&apos;id_user&apos;</span>, <span class="stringliteral">&apos;id_address&apos;</span>, $idUser, $addressIDs, <span class="keyword">true</span>);
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 
<a name="l00483"></a><a class="code" href="class_todoyu_contact_manager.html#a7f60cc467c0415df1c1c9f7e1341aad7">00483</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a7f60cc467c0415df1c1c9f7e1341aad7">saveCustomerForeignRecords</a>(array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>, $idCustomer) {
<a name="l00484"></a>00484         $idCustomer = intval($idCustomer);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486             <span class="comment">// Remove existing records</span>
<a name="l00487"></a>00487         <a class="code" href="class_todoyu_customer_manager.html#af1e4ff33e486f3df78a6d1766c635ec2">TodoyuCustomerManager::removeAllContactinfo</a>($idCustomer);
<a name="l00488"></a>00488         <a class="code" href="class_todoyu_customer_manager.html#ab90b07221c08930541c2b61676c3e42b">TodoyuCustomerManager::removeAllAddresses</a>($idCustomer);
<a name="l00489"></a>00489         <a class="code" href="class_todoyu_customer_manager.html#a343e42a3f044b9b1cd3f634c20d76c8e">TodoyuCustomerManager::removeAllUsers</a>($idCustomer);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491             <span class="comment">// Save contactinfo records</span>
<a name="l00492"></a>00492         <span class="keywordflow">if</span>( ! empty($data[<span class="stringliteral">&apos;contactinfo&apos;</span>]) ) {
<a name="l00493"></a>00493             $infoIDs    = array();
<a name="l00494"></a>00494             <span class="keywordflow">foreach</span>($data[<span class="stringliteral">&apos;contactinfo&apos;</span>] as $contactInfo) {
<a name="l00495"></a>00495                 $infoIDs[] = <a class="code" href="class_todoyu_contact_info_manager.html#a2eb5494dea333a37f8fdb201b96bcc21">TodoyuContactInfoManager::saveContactInfos</a>($contactInfo);
<a name="l00496"></a>00496             }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498             <a class="code" href="class_todoyu_db_helper.html#a18b61d6a0c4349de2adda6f0d96b3e7d">TodoyuDbHelper::saveMMrelations</a>(<span class="stringliteral">&apos;ext_user_mm_customer_contactinfo&apos;</span>, <span class="stringliteral">&apos;id_customer&apos;</span>, <span class="stringliteral">&apos;id_contactinfo&apos;</span>, $idCustomer, $infoIDs);
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500         unset($data[<span class="stringliteral">&apos;contactinfo&apos;</span>]);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a>00503             <span class="comment">// Save address records</span>
<a name="l00504"></a>00504         <span class="keywordflow">if</span>( ! empty($data[<span class="stringliteral">&apos;address&apos;</span>]) ) {
<a name="l00505"></a>00505             $addressIDs = array();
<a name="l00506"></a>00506             <span class="keywordflow">foreach</span>($data[<span class="stringliteral">&apos;address&apos;</span>] as $address) {
<a name="l00507"></a>00507                 $addressIDs[] =  <a class="code" href="class_todoyu_address_manager.html#ac22f2342c3330225a25d07f15c424255">TodoyuAddressManager::saveAddress</a>($address);
<a name="l00508"></a>00508             }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510             <a class="code" href="class_todoyu_db_helper.html#a18b61d6a0c4349de2adda6f0d96b3e7d">TodoyuDbHelper::saveMMrelations</a>(<span class="stringliteral">&apos;ext_user_mm_customer_address&apos;</span>, <span class="stringliteral">&apos;id_customer&apos;</span>, <span class="stringliteral">&apos;id_address&apos;</span>, $idCustomer, $addressIDs);
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512         unset($data[<span class="stringliteral">&apos;address&apos;</span>]);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 
<a name="l00515"></a>00515             <span class="comment">// Save users</span>
<a name="l00516"></a>00516         <span class="keywordflow">if</span>( ! empty($data[<span class="stringliteral">&apos;user&apos;</span>]) ) {
<a name="l00517"></a>00517             <span class="keywordflow">foreach</span>($data[<span class="stringliteral">&apos;user&apos;</span>] as $user) {
<a name="l00518"></a>00518                     <span class="comment">// Prepare data form mm-table</span>
<a name="l00519"></a>00519                 $user[<span class="stringliteral">&apos;id_user&apos;</span>]    = $user[<span class="stringliteral">&apos;id&apos;</span>];
<a name="l00520"></a>00520                 $user[<span class="stringliteral">&apos;id_customer&apos;</span>]= $idCustomer;
<a name="l00521"></a>00521                 unset($user[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523                     <span class="comment">// Remove existing link and save new data</span>
<a name="l00524"></a>00524                 $idLink = <a class="code" href="class_todoyu_db_helper.html#a4f0d427cb0008ca2af9364b2a79d5609">TodoyuDbHelper::saveExtendedMMrelation</a>(<span class="stringliteral">&apos;ext_user_mm_customer_user&apos;</span>, <span class="stringliteral">&apos;id_customer&apos;</span>, <span class="stringliteral">&apos;id_user&apos;</span>, $idCustomer, $user[<span class="stringliteral">&apos;id_user&apos;</span>], $user);
<a name="l00525"></a>00525             }
<a name="l00526"></a>00526         }
<a name="l00527"></a>00527         unset($data[<span class="stringliteral">&apos;user&apos;</span>]);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 
<a name="l00530"></a>00530         <span class="keywordflow">return</span> $data;
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533 
<a name="l00534"></a><a class="code" href="class_todoyu_contact_manager.html#a6b16e57ee394b3fa8887991bee43a9d6">00534</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#a6b16e57ee394b3fa8887991bee43a9d6">getUserForeignRecordData</a>(array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>, $idUser) {
<a name="l00535"></a>00535         $idUser = intval($idUser);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         $data[<span class="stringliteral">&apos;customer&apos;</span>]   = <a class="code" href="class_todoyu_user_manager.html#a6cf8ea18729913bc4b39c5d854cdf850">TodoyuUserManager::getUserCompanyRecords</a>($idUser);
<a name="l00538"></a>00538         $data[<span class="stringliteral">&apos;contactinfo&apos;</span>]= <a class="code" href="class_todoyu_user_manager.html#a6a662c479cee30142a9ada60a9af1bb8">TodoyuUserManager::getUserContactinfoRecords</a>($idUser);
<a name="l00539"></a>00539         $data[<span class="stringliteral">&apos;address&apos;</span>]    = <a class="code" href="class_todoyu_user_manager.html#aa6c2987540f33273518b7a3ef5537a36">TodoyuUserManager::getUserAddressRecords</a>($idUser);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         <span class="keywordflow">return</span> $data;
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 
<a name="l00545"></a><a class="code" href="class_todoyu_contact_manager.html#ae6d427f1101965e4b8195562ddf8a8aa">00545</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_contact_manager.html#ae6d427f1101965e4b8195562ddf8a8aa">getAddressTypes</a>() {
<a name="l00546"></a>00546         <span class="keywordflow">return</span> <a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;EXT&apos;</span>][<span class="stringliteral">&apos;contact&apos;</span>][<span class="stringliteral">&apos;addresstypes&apos;</span>];
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 ?&gt;
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Erzeugt am Tue Dec 1 18:32:34 2009 für Todoyu von&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
